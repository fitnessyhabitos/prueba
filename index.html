<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BCN Fitness</title>
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" href="logo.png" type="image/png">
    <meta name="theme-color" content="#000000">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Russo+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="splash-screen">
        <img src="logo.png" alt="BCN Fitness" class="pulse-logo" onerror="this.src='https://placehold.co/150/000000/39ff14?text=BCN'">
        <h1 style="color:white; margin-top:20px; font-family:'Russo One'">BCN FITNESS</h1>
    </div>
    <header id="app-header" class="hidden">
        <div style="display:flex; align-items:center; gap:10px">
            <img src="logo.png" alt="Logo" style="height:30px; border-radius:50%">
            <h2 id="page-title" style="margin:0; font-size:18px">BCN FITNESS</h2>
        </div>
        <div style="display:flex; gap:10px">
            <button id="admin-btn" class="icon-btn hidden" onclick="window.app.navTo('admin')"><i class="material-icons-round" style="color:var(--neon-green)">admin_panel_settings</i></button>
            <button id="logout-btn" class="icon-btn"><i class="material-icons-round">logout</i></button>
        </div>
    </header>
    <main id="main-container">
        <section id="view-login" class="view active">
            <div class="login-wrapper" style="text-align:center; padding-top:20px">
                <img src="logo.png" alt="Logo" width="100" style="border-radius:50%; margin-bottom:20px">
                <h1 style="color:var(--neon-green)">BCN FITNESS</h1>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="Email" required style="margin-bottom:10px">
                    <input type="password" id="login-password" placeholder="Contrase침a" required>
                    <button type="submit" class="btn-primary">ENTRAR</button>
                </form>
                <p class="text-link" onclick="window.app.navTo('register')" style="margin-top:20px; color:#888; cursor:pointer">Crear cuenta</p>
                <div class="install-box">
                    <div class="install-header"><i class="material-icons-round" style="color:var(--neon-green)">download</i> INSTALAR APP</div>
                    <div class="install-content">
                        <div class="install-row"><div class="brand-badge"><i class="material-icons-round">phone_iphone</i> iOS</div><span class="install-desc">Pulsa <i class="material-icons-round tiny">ios_share</i> y <strong>"A침adir a inicio"</strong></span></div>
                        <div class="install-divider"></div>
                        <div class="install-row"><div class="brand-badge"><i class="material-icons-round">android</i> Android</div><span class="install-desc">Pulsa <i class="material-icons-round tiny">more_vert</i> y <strong>"Instalar App"</strong></span></div>
                    </div>
                </div>
            </div>
        </section>
        <section id="view-register" class="view hidden">
            <h2 class="section-title">NUEVO PERFIL</h2>
            <form id="register-form">
                <input type="text" id="reg-name" placeholder="Nombre Completo" required>
                <input type="email" id="reg-email" placeholder="Email" required>
                <input type="password" id="reg-pass" placeholder="Contrase침a" required>
                <label style="color:#888; font-size:12px; margin-left:5px">Rol</label>
                <select id="reg-role-select" style="margin-bottom:15px"><option value="cliente">Cliente</option><option value="atleta">Atleta</option></select>
                <div class="row"><input type="number" id="reg-age" placeholder="Edad" required style="width: 48%"><select id="reg-sex" style="width: 48%"><option value="male">Hombre</option><option value="female">Mujer</option></select></div>
                <input type="text" id="reg-code" placeholder="C칍DIGO SECRETO" required class="input-code">
                <button type="submit" class="btn-primary">REGISTRARSE</button>
                <button type="button" class="btn-text" onclick="window.app.navTo('login')">Cancelar</button>
            </form>
        </section>
        <section id="view-dashboard" class="view hidden">
            <div id="pending-approval" class="hidden warning-box">丘멆잺 Tu cuenta espera aprobaci칩n.</div>
            <div class="section-card" id="weekly-progress-card">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px"><span>Objetivo Semanal</span><strong id="weekly-count" style="color:var(--neon-green)">0/0</strong></div>
                <div class="progress-bar-bg"><div id="weekly-bar" class="progress-bar-fill" style="width:0%"></div></div>
            </div>
            <h3>Tus Rutinas</h3>
            <div id="routines-list" class="card-list"></div>
        </section>
        <section id="view-admin" class="view hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                <h3 style="color:var(--neon-green); margin:0">PANEL COACH</h3>
                <button class="icon-btn" onclick="window.admin.refreshAll()"><i class="material-icons-round">refresh</i></button>
            </div>
            <div class="section-card"><h4>Clientes</h4><div id="admin-users-list" class="users-list-container"></div></div>
            <div class="section-card" id="routine-editor-card">
                <h4 id="routine-editor-title">Crear Rutina Base</h4>
                <input type="text" id="new-routine-name" placeholder="Nombre Rutina (Ej: Pierna A)">
                <label style="font-size:12px; color:#888">Asignar a:</label>
                <select id="assign-client-select"><option value="" disabled selected>Selecciona...</option></select>
                <div class="exercise-selector" style="margin-top:15px; position:relative">
                    <input type="search" id="exercise-search" placeholder="游댌 Buscar ejercicio..." autocomplete="off">
                    <div id="search-results-container" class="hidden" style="position:absolute; top:50px; left:0; width:100%; background:#222; border:1px solid #444; border-radius:8px; max-height:200px; overflow-y:auto; z-index:100"></div>
                </div>
                <div id="admin-routine-preview" style="margin-top:20px; border-top:1px solid #333; padding-top:10px"></div>
                <div style="display:flex; gap:10px; margin-top:20px">
                    <button class="btn-primary" id="save-routine-btn" onclick="window.admin.saveRoutine()">GUARDAR</button>
                    <button class="btn-secondary hidden" id="cancel-edit-btn" onclick="window.admin.cancelEdit()">CANCELAR</button>
                </div>
            </div>
            <div class="section-card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px">
                    <h4>Todas las Rutinas</h4>
                    <i class="material-icons-round" onclick="window.admin.renderExistingRoutines()" style="cursor:pointer; color:var(--neon-green)">refresh</i>
                </div>
                <div id="admin-routines-management" class="users-list-container"></div>
            </div>
        </section>
        <section id="view-client-detail" class="view hidden">
            <div class="workout-sticky-header">
                <button class="icon-btn" onclick="window.app.navTo('admin')"><i class="material-icons-round">arrow_back</i></button>
                <h3 id="client-detail-name" style="margin:0; font-size:16px">Cliente</h3><div style="width:28px"></div>
            </div>
            <div class="section-card" style="text-align:center">
                <img id="client-detail-img" src="assets/placeholder-body.png" class="profile-avatar" style="width:80px; height:80px; margin:0 auto; border-radius:50%; object-fit:cover">
                <p id="client-detail-age" style="color:#888; font-size:12px; margin-top:5px">Edad: --</p>
                <div class="row" style="margin-top:15px; text-align:center">
                    <div><strong id="cd-weight" style="color:var(--neon-green)">--</strong><div style="font-size:10px">PESO</div></div>
                    <div><strong id="cd-fat" style="color:#ff3b30">--</strong><div style="font-size:10px">GRASA</div></div>
                    <div><strong id="cd-muscle" style="color:#00d4ff">--</strong><div style="font-size:10px">M칔SC</div></div>
                </div>
                <div style="margin-top:15px; background:#222; padding:10px; border-radius:8px; text-align:left">
                    <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px"><span>Objetivo Semanal</span><strong id="client-weekly-count" style="color:var(--neon-green)">0/0</strong></div>
                    <div class="progress-bar-bg"><div id="client-weekly-bar" class="progress-bar-fill" style="width:0%"></div></div>
                </div>
            </div>
            <div class="section-card" style="border-left: 4px solid var(--neon-green)">
                <h4>Rutinas Asignadas</h4>
                <div id="client-routines-list"></div>
                <div style="margin-top:15px; border-top:1px solid #333; padding-top:10px">
                    <label style="font-size:12px; color:#888;">Clonar nueva rutina:</label>
                    <div style="display:flex; gap:10px"><select id="client-clone-select" style="margin:0"></select><button class="btn-secondary" style="width:auto; margin:0" onclick="window.admin.cloneRoutineFromClientView()">+</button></div>
                </div>
            </div>
            <div class="section-card"><h4>Mapa Muscular</h4><div class="chart-container"><canvas id="clientRadarChart"></canvas></div></div>
            <div class="section-card"><h4>Evoluci칩n Peso</h4><div class="chart-container"><canvas id="clientWeightChart"></canvas></div></div>
            <div class="section-card"><h4>Grasa %</h4><div class="chart-container"><canvas id="clientFatChart"></canvas></div></div>
            <div class="section-card"><h4>M칰sculo %</h4><div class="chart-container"><canvas id="clientMuscleChart"></canvas></div></div>
            <div class="section-card"><h4>Historial</h4><div id="client-detail-history" class="history-container"></div></div>
        </section>
        <section id="view-workout" class="view hidden">
            <div class="workout-sticky-header">
                <div class="timer-box"><span class="timer-label">TIEMPO</span><span id="global-timer">00:00</span></div>
                <div style="display:flex; gap:5px">
                    <button onclick="window.workoutManager.cancelWorkout()" class="btn-danger-outline">CANCELAR</button>
                    <button onclick="window.workoutManager.openFinishModal()" class="btn-finish">FINALIZAR</button>
                </div>
            </div>
            <div id="active-exercises-container"></div>
        </section>
        <section id="view-profile" class="view hidden">
            <div class="profile-header">
                <div class="avatar-container" onclick="document.getElementById('avatar-input').click()">
                    <img id="profile-img" src="assets/placeholder-body.png" class="profile-avatar" style="border-radius:50%; object-fit:cover" onerror="this.src='https://placehold.co/150/000000/39ff14?text=FOTO'">
                    <div class="avatar-overlay"><i class="material-icons-round">photo_camera</i></div>
                </div>
                <input type="file" id="avatar-input" hidden accept="image/*" onchange="window.profile.uploadPhoto(this)">
                <h2 id="profile-name">...</h2>
                <span id="profile-role-badge" class="role-badge">Cliente</span>
            </div>
            <div class="profile-tabs">
                <button id="tab-btn-stats" class="tab-btn active" onclick="window.profile.switchTab('stats')">Progreso</button>
                <button id="tab-btn-history" class="tab-btn" onclick="window.profile.switchTab('history')">Historial</button>
                <button id="tab-btn-config" class="tab-btn" onclick="window.profile.switchTab('config')">Ajustes</button>
            </div>
            <div id="tab-stats" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-box"><small>TONELADAS</small><strong id="stat-tonnage">0t</strong></div>
                    <div class="stat-box"><small>SERIES</small><strong id="stat-sets">0</strong></div>
                    <div class="stat-box"><small>REPS</small><strong id="stat-reps">0</strong></div>
                    <div class="stat-box"><small>ENTRENOS</small><strong id="stat-workouts">0</strong></div>
                </div>
                <div class="section-card">
                    <h3>Actualizar Medidas</h3>
                    <div class="row"><input type="number" id="stats-weight" placeholder="Peso (kg)" style="width:32%"><input type="number" id="stats-fat" placeholder="% Grasa" style="width:32%"><input type="number" id="stats-muscle" placeholder="% M칰sc" style="width:32%"></div>
                    <button class="btn-primary" onclick="window.profile.saveStats()">REGISTRAR</button>
                </div>
                <div class="section-card"><h3>Peso (kg)</h3><div class="chart-container"><canvas id="weightChart"></canvas></div></div>
                <div class="section-card"><h3>Grasa (%)</h3><div class="chart-container"><canvas id="fatChart"></canvas></div></div>
                <div class="section-card"><h3>M칰sculo (%)</h3><div class="chart-container"><canvas id="muscleChart"></canvas></div></div>
                <div class="section-card"><h3>Mapa Muscular</h3><div class="chart-container"><canvas id="radarChart"></canvas></div></div>
            </div>
            <div id="tab-history" class="tab-content hidden"><div id="history-list" class="history-container">Cargando...</div></div>
            <div id="tab-config" class="tab-content hidden">
                <div class="section-card">
                    <h3>Configuraci칩n</h3>
                    <label>Objetivo Semanal (D칤as):</label><input type="number" id="conf-weekly-goal" placeholder="4">
                    <label>Tiempo Descanso (seg):</label><input type="number" id="conf-rest-time" placeholder="60">
                    <button class="btn-secondary" onclick="window.profile.saveSettings()">GUARDAR CAMBIOS</button>
                    <div class="settings-row" style="margin-top:20px; display:flex; gap:10px">
                        <button class="btn-icon-large" onclick="window.profile.requestNotify()">游댒 Avisos</button>
                        <button class="btn-icon-large" onclick="window.profile.testSound()">游댉 Test</button>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <div id="edit-user-modal" class="modal-overlay hidden" style="z-index: 10002;">
        <div class="modal-content" style="background:#111; padding:20px; border-radius:10px;">
            <h3>Editar Usuario</h3>
            <input type="text" id="edit-user-name" placeholder="Nombre">
            <select id="edit-user-role">
                <option value="cliente">Cliente</option>
                <option value="atleta">Atleta</option>
                <option value="coach">Coach (Admin)</option>
            </select>
            <div style="display:flex; gap:10px; margin-top:15px">
                <button class="btn-primary" onclick="window.admin.saveUserChanges()">GUARDAR</button>
                <button class="btn-secondary" onclick="document.getElementById('edit-user-modal').classList.add('hidden')">CANCELAR</button>
            </div>
        </div>
    </div>
    <div id="toast-container"></div>
    <div id="rest-modal" class="modal-overlay hidden" style="z-index: 10000;">
        <div class="modal-content" style="background:black; border:2px solid var(--neon-green); padding:30px; border-radius:20px;">
            <h1 id="rest-countdown">00:00</h1>
            <button onclick="window.workoutManager.stopRest()" class="btn-primary">춰SEGUIR!</button>
        </div>
    </div>
    <div id="finish-modal" class="modal-overlay hidden" style="z-index: 9998;">
        <div class="modal-content" style="background:#111; padding:20px; border-radius:10px;">
            <h3>쯈U칄 TAL FUE?</h3>
            <div class="traffic-light-container">
                <button class="traffic-btn green" onclick="window.workoutManager.confirmFinish('Ligero')">游땕 F츼CIL</button>
                <button class="traffic-btn orange" onclick="window.workoutManager.confirmFinish('Moderado')">游땛 MEDIO</button>
                <button class="traffic-btn red" onclick="window.workoutManager.confirmFinish('Intenso')">游댠 DIFICIL</button>
            </div>
            <textarea id="final-notes" placeholder="Notas..." style="width:100%"></textarea>
            <button onclick="document.getElementById('finish-modal').classList.add('hidden')" class="btn-text">Volver</button>
        </div>
    </div>
    <div id="workout-detail-modal" class="modal-overlay hidden" style="z-index: 9997;">
        <div class="modal-content" style="width:95%; max-height:80vh; overflow-y:auto; text-align:left">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                <h3 style="margin:0" id="wd-title">Detalles</h3>
                <button onclick="document.getElementById('workout-detail-modal').classList.add('hidden')" class="icon-btn"><i class="material-icons-round">close</i></button>
            </div>
            <div id="wd-content"></div>
        </div>
    </div>
    <nav id="bottom-nav" class="hidden">
        <div onclick="window.app.navTo('dashboard')" class="nav-item active"><i class="material-icons-round">dashboard</i><span>Inicio</span></div>
        <div onclick="window.app.navTo('profile')" class="nav-item"><i class="material-icons-round">person</i><span>Perfil</span></div>
    </nav>
    <audio id="timer-beep" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
    <script type="module" src="app.js"></script>
    <script>setTimeout(function(){var s=document.getElementById('splash-screen');if(s&&!s.classList.contains('hidden'))s.style.display='none';},3000);</script>
</body>
</html>
